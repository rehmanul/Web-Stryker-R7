<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Center - Web Stryker R7</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    .dark ::-webkit-scrollbar-track {
      background: #2d3748;
    }
    
    .dark ::-webkit-scrollbar-thumb {
      background: #4a5568;
    }
    
    .dark ::-webkit-scrollbar-thumb:hover {
      background: #718096;
    }

    /* Animations */
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .animate-pulse {
      animation: pulse 2s infinite;
    }

    .animate-spin {
      animation: spin 1s linear infinite;
    }
  </style>
</head>

<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white">
  <!-- Header -->
  <header class="bg-white dark:bg-gray-800 shadow-md">
    <div class="container mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <i class="fas fa-database text-blue-600 dark:text-blue-400 text-2xl"></i>
          <h1 class="text-xl font-semibold">Data Center</h1>
        </div>
        <div class="flex items-center space-x-4">
          <span id="statusIndicator" class="flex items-center">
            <i class="fas fa-circle text-green-500 mr-2"></i>
            <span>Ready</span>
          </span>
          <button onclick="toggleTheme()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="fas fa-moon dark:hidden"></i>
            <i class="fas fa-sun hidden dark:block text-yellow-400"></i>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <!-- URL Input Section -->
    <section class="mb-8">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
        <h2 class="text-lg font-semibold mb-4">Enter URLs for Extraction</h2>
        
        <div class="mb-4">
          <textarea id="urlInput" 
                    rows="5" 
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    placeholder="Enter URLs (one per line)"></textarea>
        </div>
        
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <button onclick="loadSampleUrls()" class="btn-secondary">
              <i class="fas fa-list mr-2"></i>Load Sample URLs
            </button>
            <button onclick="clearUrls()" class="btn-secondary">
              <i class="fas fa-trash mr-2"></i>Clear
            </button>
          </div>
          
          <button onclick="startExtraction()" id="extractButton" class="btn-primary">
            <i class="fas fa-play mr-2"></i>Start Extraction
          </button>
        </div>
      </div>
    </section>

    <!-- Progress Section -->
    <section class="mb-8 hidden" id="progressSection">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
        <h2 class="text-lg font-semibold mb-4">Extraction Progress</h2>
        
        <div class="mb-4">
          <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full">
            <div id="progressBar" 
                 class="h-2 bg-blue-600 rounded-full transition-all duration-300" 
                 style="width: 0%"></div>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
          <div class="stat-card">
            <div class="text-sm text-gray-600 dark:text-gray-400">Processed</div>
            <div class="text-2xl font-semibold"><span id="processedCount">0</span>/<span id="totalCount">0</span></div>
          </div>
          
          <div class="stat-card">
            <div class="text-sm text-gray-600 dark:text-gray-400">Success Rate</div>
            <div class="text-2xl font-semibold text-green-600 dark:text-green-400" id="successRate">0%</div>
          </div>
          
          <div class="stat-card">
            <div class="text-sm text-gray-600 dark:text-gray-400">Average Time</div>
            <div class="text-2xl font-semibold" id="avgTime">0ms</div>
          </div>
          
          <div class="stat-card">
            <div class="text-sm text-gray-600 dark:text-gray-400">Estimated Time</div>
            <div class="text-2xl font-semibold" id="eta">--:--</div>
          </div>
        </div>
        
        <div class="flex justify-end">
          <button onclick="stopExtraction()" id="stopButton" class="btn-danger">
            <i class="fas fa-stop mr-2"></i>Stop
          </button>
        </div>
      </div>
    </section>

    <!-- Results Section -->
    <section class="mb-8">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold">Extraction Results</h2>
          <div class="flex items-center space-x-4">
            <button onclick="exportResults()" class="btn-secondary">
              <i class="fas fa-download mr-2"></i>Export
            </button>
            <button onclick="clearResults()" class="btn-secondary">
              <i class="fas fa-trash mr-2"></i>Clear
            </button>
          </div>
        </div>
        
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead>
              <tr>
                <th class="px-6 py-3 bg-gray-50 dark:bg-gray-900 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">URL</th>
                <th class="px-6 py-3 bg-gray-50 dark:bg-gray-900 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 bg-gray-50 dark:bg-gray-900 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Company</th>
                <th class="px-6 py-3 bg-gray-50 dark:bg-gray-900 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Products</th>
                <th class="px-6 py-3 bg-gray-50 dark:bg-gray-900 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody id="resultsTable" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
              <!-- Results will be inserted here -->
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Detail Modal -->
  <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden">
      <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
        <h2 class="text-xl font-semibold">Extraction Details</h2>
        <button onclick="closeDetailModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="p-6 overflow-y-auto" id="detailContent">
        <!-- Detail content will be inserted here -->
      </div>
    </div>
  </div>

  <script>
    // Sample URLs
    const sampleUrls = [
      'http://www.mancusogelati.it',
      'https://www.linkosuo.fi/',
      'https://thealphatrader.co/',
      'https://www.goldandgreenfoods.com/',
      'https://www.atriafromfinland.com/',
      'https://www.evoke.fi/',
      'https://www.raisio.com/',
      'https://www.moilas.com/',
      'https://www.qdb.qa/',
      'https://gea.si/',
      'https://www.quinuasaite.com.bo/',
      'https://www.spiritslovenia.si/',
      'https://www.yvayafarm.com/'
    ];

    // Load sample URLs
    function loadSampleUrls() {
      document.getElementById('urlInput').value = sampleUrls.join('\n');
    }

    // Clear URL input
    function clearUrls() {
      document.getElementById('urlInput').value = '';
    }

    // Start extraction process
    function startExtraction() {
      const urls = document.getElementById('urlInput').value
        .split('\n')
        .map(url => url.trim())
        .filter(url => url);

      if (urls.length === 0) {
        alert('Please enter at least one URL');
        return;
      }

      // Show progress section
      document.getElementById('progressSection').classList.remove('hidden');
      document.getElementById('totalCount').textContent = urls.length;
      
      // Disable start button
      document.getElementById('extractButton').disabled = true;
      
      // Start extraction using Google Apps Script
      google.script.run
        .withSuccessHandler(onExtractionComplete)
        .withFailureHandler(onExtractionError)
        .startExtraction(urls);
    }

    // Handle extraction completion
    function onExtractionComplete(results) {
      document.getElementById('extractButton').disabled = false;
      document.getElementById('progressSection').classList.add('hidden');
      
      // Update results table
      updateResultsTable(results);
    }

    // Handle extraction error
    function onExtractionError(error) {
      document.getElementById('extractButton').disabled = false;
      document.getElementById('progressSection').classList.add('hidden');
      
      alert('Error during extraction: ' + error.message);
    }

    // Update results table
    function updateResultsTable(results) {
      const tbody = document.getElementById('resultsTable');
      tbody.innerHTML = '';

      results.forEach(result => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap">
            <a href="${result.url}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">${result.url}</a>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 py-1 rounded-full text-xs ${
              result.success 
                ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'
                : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'
            }">
              ${result.success ? 'Success' : 'Failed'}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            ${result.data?.companyName || '-'}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            ${result.data?.productNames?.length || 0} products
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <button onclick="showDetails('${result.url}')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200">
              <i class="fas fa-eye mr-1"></i>Details
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Show extraction details
    function showDetails(url) {
      google.script.run
        .withSuccessHandler(showDetailModal)
        .withFailureHandler(error => alert('Error loading details: ' + error.message))
        .getExtractionDetails(url);
    }

    // Show detail modal
    function showDetailModal(details) {
      const modal = document.getElementById('detailModal');
      const content = document.getElementById('detailContent');
      
      content.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-semibold mb-4">Company Information</h3>
            <dl class="space-y-2">
              <dt class="text-sm text-gray-600 dark:text-gray-400">Name</dt>
              <dd class="font-medium">${details.companyName || '-'}</dd>
              
              <dt class="text-sm text-gray-600 dark:text-gray-400">Type</dt>
              <dd class="font-medium">${details.companyType || '-'}</dd>
              
              <dt class="text-sm text-gray-600 dark:text-gray-400">Description</dt>
              <dd class="font-medium">${details.description || '-'}</dd>
            </dl>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold mb-4">Contact Information</h3>
            <dl class="space-y-2">
              <dt class="text-sm text-gray-600 dark:text-gray-400">Emails</dt>
              <dd class="font-medium">${details.emails?.join(', ') || '-'}</dd>
              
              <dt class="text-sm text-gray-600 dark:text-gray-400">Phones</dt>
              <dd class="font-medium">${details.phones?.join(', ') || '-'}</dd>
              
              <dt class="text-sm text-gray-600 dark:text-gray-400">Addresses</dt>
              <dd class="font-medium">${details.addresses?.join(', ') || '-'}</dd>
            </dl>
          </div>
          
          <div class="md:col-span-2">
            <h3 class="text-lg font-semibold mb-4">Products</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              ${(details.productNames || []).map((name, i) => `
                <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-4">
                  <h4 class="font-medium mb-2">${name}</h4>
                  ${
                    details.productImages?.[i]
                      ? `<img src="${details.productImages[i]}" alt="${name}" class="w-full h-32 object-cover rounded-lg mb-2">`
                      : ''
                  }
                  ${
                    details.productQuantities?.[i]
                      ? `<p class="text-sm text-gray-600 dark:text-gray-400">${details.productQuantities[i]}</p>`
                      : ''
                  }
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
      
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    // Close detail modal
    function closeDetailModal() {
      const modal = document.getElementById('detailModal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }

    // Export results
    function exportResults() {
      google.script.run
        .withSuccessHandler(() => alert('Results exported successfully'))
        .withFailureHandler(error => alert('Error exporting results: ' + error.message))
        .exportResults();
    }

    // Clear results
    function clearResults() {
      if (confirm('Are you sure you want to clear all results?')) {
        document.getElementById('resultsTable').innerHTML = '';
        google.script.run
          .withFailureHandler(error => alert('Error clearing results: ' + error.message))
          .clearResults();
      }
    }

    // Toggle theme
    function toggleTheme() {
      document.documentElement.classList.toggle('dark');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Check system dark mode preference
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
      }
    });
  </script>
</body>
</html>
